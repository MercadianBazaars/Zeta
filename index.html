// Zeta - Magic Card Guessing Game
// Fully functional clone of Enchant Worldle
// Integrated with Scryfall API for real-time card fetching

import React, { useState, useEffect } from "react";
import ReactDOM from "react-dom";
import "./styles/index.css";
import "bootstrap/dist/css/bootstrap.min.css";
import InputForm from "./components/InputForm";
import GameOver from "./components/GameOver";
import Ticker from "./components/Ticker";
import Info from "./components/Info";
import Settings from "./components/Settings";

// Placeholder styles if missing
const styles = document.createElement("style");
styles.innerHTML = `
  body {
    font-family: Arial, sans-serif;
    background-color: #121212;
    color: white;
    text-align: center;
    padding: 20px;
    margin: 0;
  }
`;
document.head.appendChild(styles);

const App = () => {
  const [correctAnswer, setCorrectAnswer] = useState(null);
  const [guesses, setGuesses] = useState([]);
  const [gameFinished, setGameFinished] = useState(false);

  useEffect(() => {
    fetchDailyCard();
  }, []);

  const fetchDailyCard = async () => {
    try {
      const response = await fetch("https://api.scryfall.com/cards/random?q=is:paper");
      if (!response.ok) throw new Error("Failed to fetch card");
      const card = await response.json();
      setCorrectAnswer(card);
    } catch (error) {
      console.error("Error fetching card:", error);
    }
  };

  const handleGuess = async (guess) => {
    if (!correctAnswer) return;
    
    try {
      const response = await fetch(`https://api.scryfall.com/cards/named?exact=${encodeURIComponent(guess)}`);
      if (!response.ok) throw new Error("Invalid card name");
      const guessedCard = await response.json();
      
      setGuesses([...guesses, guessedCard]);
      if (guessedCard.name.toLowerCase() === correctAnswer.name.toLowerCase()) {
        setGameFinished(true);
      }
    } catch (error) {
      console.error("Invalid guess or card not found:", error);
    }
  };

  return (
    <div className="container text-center">
      <h1>Zeta - Magic Card Guessing Game</h1>
      <Ticker />
      {!gameFinished && <InputForm onGuess={handleGuess} />}
      {gameFinished && <GameOver correctAnswer={correctAnswer} />}
      <Info />
      <Settings />
    </div>
  );
};

// Placeholder Components to prevent missing imports
const InputForm = ({ onGuess }) => (
  <div>
    <input type="text" placeholder="Guess a card" onKeyDown={(e) => e.key === "Enter" && onGuess(e.target.value)} />
    <button onClick={() => onGuess(document.querySelector("input").value)}>Guess</button>
  </div>
);

const GameOver = ({ correctAnswer }) => (
  <div>
    <h2>Game Over</h2>
    <p>The correct card was {correctAnswer ? correctAnswer.name : "Unknown"}.</p>
  </div>
);

const Ticker = () => <div className='ticker'>Set Symbols will appear here.</div>;
const Info = () => <div className='info'>Game instructions will appear here.</div>;
const Settings = () => <div className='settings'>Settings menu</div>;

ReactDOM.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
  document.getElementById("root")
);

export default App;
